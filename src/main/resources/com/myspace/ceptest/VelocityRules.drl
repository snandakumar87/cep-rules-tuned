package com.myspace.ceptest;



import fraud.analysis.demo.transaction.*;


declare Transaction @role( event )  @timestamp( txnTS ) end

rule "Velocity Rule 1"
when
  curr: CurrentTxn()
  accumulate ($cct: Transaction(txnCntry != 'IN', this.cardNumber == curr.cardNumber) over window:time (1415m) from entry-point Reference;
    $nrOfTransactions : count($cct);
    $nrOfTransactions >= 2
   )
  $t: Transaction(this.cardNumber == curr.cardNumber) from $list
then
  CEPFraud cepFraud = new CEPFraud();
  cepFraud.setTransactionId(curr.getTransactionId());
  cepFraud.setFraudReason('Flagged tx based on velocity rule 1 for ' + curr.getCardNumber());
  insert(cepFraud);
end